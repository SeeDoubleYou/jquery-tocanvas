/*
 *  jquery-tocanvas - v0.2.0
 *  A jquery plugin to overlay any img with a canvas to add effects to it
 *  http://seedoubleyou.nl
 *
 *  Made by Cees-Willem Hofstede
 *  Under MIT License
 */
!function(a,b,c,d){"use strict";function e(b,c){this.element=b,this.$element=a(this.element),this.canvas=a("<canvas>"),this.$canvas=a(this.canvas),this.context,this.wrapper=a("<div>"),this.$wrapper=a(this.wrapper),this.imageObj,this.imgData,this.pixels,this.renderCount=0,this.settings=a.extend({},g,c),this._defaults=g,this._name=f,this.init()}var f="toCanvas",g={framerate:0,hoverOpacity:1,opacity:1,process:{},zIndex:10};a.extend(e.prototype,{init:function(){var b=this;if(b.w=b.$element.width(),b.h=b.$element.height(),b.$wrapper.addClass("tc_wrapper").css({display:"inline-block",height:b.h,position:"relative",width:b.w}),b.$canvas.addClass("tc_canvas").css({left:0,opacity:b.settings.opacity,position:"absolute",top:0,zIndex:b.settings.zIndex}).hover(function(){a(this).css({opacity:b.settings.hoverOpacity})},function(){a(this).css({opacity:b.settings.opacity})}).attr({height:b.h,width:b.w}),b.$element.addClass("tc_image").wrap(b.$wrapper).before(b.$canvas),b.context=this.canvas.get(0).getContext("2d"),b.$element.is("img"))b.imageObj=new Image,b.imageObj.onload=function(){b.render()},b.imageObj.src=this.$element.attr("src");else{if(!b.$element.is("video"))return;b.imageObj=b.element,b.$element.on("play",function(){b.render()}),b.$element.trigger("play")}},render:function(){var c=this;c.context.drawImage(c.imageObj,0,0,c.w,c.h),c.imgd=c.context.getImageData(0,0,c.w,c.h),c.pixels=c.imgd.data,c.nrPixels=c.pixels.length,c.context.putImageData(c.imgd,0,0),a.each(c.settings.process,function(a,b){var d=Object.keys(b)[0],e=b[d];c[d](e)}),c.context.putImageData(c.imgd,0,0),c.renderCount++,c.settings.framerate>0&&b.setTimeout(function(){c.render()},1e3/c.settings.framerate)},process:function(a){for(var b=0;b<this.w;b++)for(var c=0;c<this.h;c++){var d=4*(c*this.w+b),e=this.pixels[d],f=this.pixels[d+1],g=this.pixels[d+2],h=this.pixels[d+3],i=a(e,f,g,h,b,c);this.pixels[d]=i[0],this.pixels[d+1]=i[1],this.pixels[d+2]=i[2],this.pixels[d+3]=i[3]}return this},grayscale:function(){return this.process(function(a,b,c,d){var e=.3*a+.59*b+.11*c;return[e,e,e,d]})},sepia:function(){return this.process(function(a,b,c,d){return[.393*a+.769*b+.189*c,.349*a+.686*b+.168*c,.272*a+.534*b+.131*c,d]})},invert:function(){return this.process(function(a,b,c,d){return[255-a,255-b,255-c,d]})},vignette:function(b){b=a.extend({},{size:.5,opacity:1},b);var c=Math.sqrt(Math.pow(this.w/2,2)+Math.pow(this.h/2,2)),d=this.context.createRadialGradient(this.w/2,this.h/2,0,this.w/2,this.h/2,c);this.context.putImageData(this.imgd,0,0),this.context.globalCompositeOperation="source-over",d.addColorStop(0,"rgba(0,0,0,0)"),d.addColorStop(b.size,"rgba(0,0,0,0)"),d.addColorStop(1,"rgba(0,0,0,"+b.opacity+")"),this.context.fillStyle=d,this.context.fillRect(0,0,this.w,this.h),this.imgd=this.context.getImageData(0,0,this.w,this.h),this.pixels=this.imgd.data},threshold:function(a){return a=a||127,this.process(function(b,c,d,e){var f=.2126*b+.7152*c+.0722*d>=a?255:0;return[f,f,f,e]})},brightness:function(b){return b===d&&a.error("brightness adjustment not set"),this.process(function(a,c,d,e){return[a+b,c+b,d+b,e]})},saturation:function(b){b===d&&a.error("saturation adjustment not set");var c=this;return this.process(function(a,d,e,f){var g=c.rgb2hsl(a,d,e);g.s=Math.min(Math.max(b/100,0),1);var h=c.hsl2rgb(g.h,g.s,g.l);return[h.r,h.g,h.b,f]})},contrast:function(b){b===d&&a.error("contrast adjustment not set");var c=Math.pow((b+100)/100,2);return this.process(function(a,b,d,e){return[255*((a/255-.5)*c+.5),255*((b/255-.5)*c+.5),255*((d/255-.5)*c+.5),e]})},gamma:function(b){return b===d&&a.error("gamma adjustment not set"),this.process(function(a,c,d,e){return[a*b,c*b,d*b,e]})},rgb2hsl:function(a,b,c){a/=255,b/=255,c/=255;var d,e,f=Math.max(a,b,c),g=Math.min(a,b,c),h=(f+g)/2;if(f===g)d=e=0;else{var i=f-g;switch(e=h>.5?i/(2-f-g):i/(f+g),f){case a:d=(b-c)/i+(c>b?6:0);break;case b:d=(c-a)/i+2;break;case c:d=(a-b)/i+4}}return d/=6,{h:d,s:e,l:h}},hsl2rgb:function(a,b,c){var d,e,f;if(0===b)d=e=f=c;else{var g=.5>c?c*(1+b):c+b-c*b,h=2*c-g;d=this.hue2rgb(h,g,a+1/3),e=this.hue2rgb(h,g,a),f=this.hue2rgb(h,g,a-1/3)}return{r:255*d,g:255*e,b:255*f}},hue2rgb:function(a,b,c){return 0>c&&(c+=1),c>1&&(c-=1),1/6>c?a+6*(b-a)*c:.5>c?b:2/3>c?a+(b-a)*(2/3-c)*6:a}}),a.fn[f]=function(c){var d=!!b.CanvasRenderingContext2D;if(d)return this.each(function(){a.data(this,"plugin_"+f)||a.data(this,"plugin_"+f,new e(this,c))})}}(jQuery,window,document);