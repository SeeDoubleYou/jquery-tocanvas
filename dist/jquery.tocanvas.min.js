/*
 *  jquery-tocanvas - v0.2.0
 *  A jquery plugin to overlay any img with a canvas to add effects to it
 *  http://seedoubleyou.nl
 *
 *  Made by Cees-Willem Hofstede
 *  Under MIT License
 */
!function(a,b,c,d){"use strict";function e(b,c){this.element=b,this.$element=a(this.element),this.canvas=a("<canvas>"),this.$canvas=a(this.canvas),this.wrapper=a("<div>"),this.$wrapper=a(this.wrapper),this.renderCount=0,this.settings=a.extend({},g,c),this._defaults=g,this._name=f,this.init()}var f="toCanvas",g={framerate:0,hoverOpacity:1,opacity:1,overlay:!0,process:{},zIndex:10};a.extend(e.prototype,{init:function(){var a=this;if(a.$element.is("img"))a.imageObj=new Image,a.imageObj.onload=function(){a.setup(),a.render()},a.imageObj.src=this.$element.attr("src");else{if(!a.$element.is("video"))return;a.imageObj=a.element,a.$element.on("play",function(){a.setup(),a.render()}),a.$element.trigger("play")}},setup:function(){var b=this;b.w=b.$element.width(),b.h=b.$element.height(),b.$wrapper.addClass("tc_wrapper").css({display:"inline-block",height:b.h,position:"relative",width:b.w});var c=b.settings.overlay?{left:0,opacity:b.settings.opacity,position:"absolute",top:0,zIndex:b.settings.zIndex}:{opacity:b.settings.opacity};b.$canvas.addClass("tc_canvas").css(c).hover(function(){a(this).css({opacity:b.settings.hoverOpacity})},function(){a(this).css({opacity:b.settings.opacity})}).attr({height:b.h,width:b.w}),b.$element.addClass("tc_image"),b.settings.overlay?(b.$element.wrap(b.$wrapper),b.$element.before(b.$canvas)):b.$element.after(b.$canvas),b.context=this.canvas.get(0).getContext("2d")},render:function(){var c=this;return c.imageObj.paused||c.imageObj.ended?!1:(c.context.drawImage(c.imageObj,0,0,c.w,c.h),c.imgdIn=c.context.getImageData(0,0,c.w,c.h),c.pixelsIn=c.imgdIn.data,c.nrPixels=c.pixelsIn.length,a.each(c.settings.process,function(a,b){c.imgdOut=c.context.getImageData(0,0,c.w,c.h),c.pixelsOut=c.imgdOut.data;var d=Object.keys(b)[0],e=b[d];c[d](e),c.putImageData()}),c.renderCount++,void(c.settings.framerate>0&&b.setTimeout(function(){c.render()},1e3/c.settings.framerate)))},putImageData:function(){this.context.putImageData(this.imgdOut,0,0),this.imgdIn=this.imgdOut,this.imgdIn=this.context.getImageData(0,0,this.w,this.h),this.pixelsIn=this.imgdIn.data,this.nrPixels=this.pixelsIn.length},process:function(a){for(var b=0;b<this.w;b++)for(var c=0;c<this.h;c++){var d=4*(c*this.w+b),e=this.pixelsIn[d],f=this.pixelsIn[d+1],g=this.pixelsIn[d+2],h=this.pixelsIn[d+3],i=a(e,f,g,h,b,c,d);this.pixelsOut[d]=i[0],this.pixelsOut[d+1]=i[1],this.pixelsOut[d+2]=i[2],this.pixelsOut[d+3]=i[3]}return this},grayscale:function(){return this.process(function(a,b,c,d){var e=.3*a+.59*b+.11*c;return[e,e,e,d]})},sepia:function(){return this.process(function(a,b,c,d){return[.393*a+.769*b+.189*c,.349*a+.686*b+.168*c,.272*a+.534*b+.131*c,d]})},invert:function(){return this.process(function(a,b,c,d){return[255-a,255-b,255-c,d]})},edges:function(){var a=this,b=4*a.w;return a.process(function(c,d,e,f,g,h,i){return c=127+2*c-a.pixels[i+4]-a.pixels[i+b],d=127+2*d-a.pixels[i+5]-a.pixels[i+1+b],e=127+2*e-a.pixels[i+6]-a.pixels[i+2+b],[c,d,e,f]})},noise:function(a){return a=a||10,this.process(function(b,c,d,e){return[b+(.5-Math.random())*a,c+(.5-Math.random())*a,d+(.5-Math.random())*a,e]})},blur:function(){var a=this;return a.process(function(b,c,d,e,f,g,h){var i=a.convolutionFilter([[.1,.1,.1],[.1,.2,.1],[.1,.1,.1]],h);return[i[0],i[1],i[2],e]})},boxBlur:function(a){a=a||3;for(var b=this,c=a*a,d=1/c,e=[],f=0;a>f;f++){for(var g=[],h=0;a>h;h++)g.push(d);e.push(g)}return b.process(function(a,c,d,f,g,h,i){var j=b.convolutionFilter(e,i);return[j[0],j[1],j[2],f]})},sharpen:function(){var a=this;return a.process(function(b,c,d,e,f,g,h){var i=a.convolutionFilter([[0,-1,0],[-1,5,-1],[0,-1,0]],h);return[i[0],i[1],i[2],e]})},emboss:function(){var a=this;return a.process(function(b,c,d,e,f,g,h){var i=a.convolutionFilter([[2,0,0],[0,-1,0],[0,0,-1]],h,{offset:127});return[i[0],i[1],i[2],e]})},laplace:function(){var a=this;return a.process(function(b,c,d,e,f,g,h){var i=a.convolutionFilter([[0,1,0],[1,-4,1],[0,1,0]],h);return[i[0],i[1],i[2],e]})},sobel:function(){return this.sobelVertical(),this.putImageData(),this.sobelHorizontal()},sobelVertical:function(){var a=this;return a.process(function(b,c,d,e,f,g,h){var i=a.convolutionFilter([[-1,0,1],[-2,0,2],[-1,0,1]],h);return b=i[0],c=i[1],d=i[2],[i[0],i[1],i[2],e]})},sobelHorizontal:function(){var a=this;return a.process(function(b,c,d,e,f,g,h){var i=a.convolutionFilter([[-1,-2,-1],[0,0,0],[1,2,1]],h);return b=i[0],c=i[1],d=i[2],[i[0],i[1],i[2],e]})},vignette:function(b){b=a.extend({},{size:.5,opacity:1},b);var c=Math.sqrt(Math.pow(this.w/2,2)+Math.pow(this.h/2,2)),d=this.context.createRadialGradient(this.w/2,this.h/2,0,this.w/2,this.h/2,c);this.context.putImageData(this.imgdOut,0,0),this.context.globalCompositeOperation="source-over",d.addColorStop(0,"rgba(0,0,0,0)"),d.addColorStop(b.size,"rgba(0,0,0,0)"),d.addColorStop(1,"rgba(0,0,0,"+b.opacity+")"),this.context.fillStyle=d,this.context.fillRect(0,0,this.w,this.h),this.imgdOut=this.context.getImageData(0,0,this.w,this.h),this.pixelsOut=this.imgdOut.data},threshold:function(a){return a=a||127,this.process(function(b,c,d,e){var f=.2126*b+.7152*c+.0722*d>=a?255:0;return[f,f,f,e]})},brightness:function(b){return b===d&&a.error("brightness adjustment not set"),this.process(function(a,c,d,e){return[a+b,c+b,d+b,e]})},saturation:function(b){b===d&&a.error("saturation adjustment not set");var c=this;return this.process(function(a,d,e,f){var g=c.rgb2hsl(a,d,e);g.s=Math.min(Math.max(b/100,0),1);var h=c.hsl2rgb(g.h,g.s,g.l);return[h.r,h.g,h.b,f]})},contrast:function(b){b===d&&a.error("contrast adjustment not set");var c=Math.pow((b+100)/100,2);return this.process(function(a,b,d,e){return[255*((a/255-.5)*c+.5),255*((b/255-.5)*c+.5),255*((d/255-.5)*c+.5),e]})},gamma:function(b){return b===d&&a.error("gamma adjustment not set"),this.process(function(a,c,d,e){return[a*b,c*b,d*b,e]})},rgb2hsl:function(a,b,c){a/=255,b/=255,c/=255;var d,e,f=Math.max(a,b,c),g=Math.min(a,b,c),h=(f+g)/2;if(f===g)d=e=0;else{var i=f-g;switch(e=h>.5?i/(2-f-g):i/(f+g),f){case a:d=(b-c)/i+(c>b?6:0);break;case b:d=(c-a)/i+2;break;case c:d=(a-b)/i+4}}return d/=6,{h:d,s:e,l:h}},hsl2rgb:function(a,b,c){var d,e,f;if(0===b)d=e=f=c;else{var g=.5>c?c*(1+b):c+b-c*b,h=2*c-g;d=this.hue2rgb(h,g,a+1/3),e=this.hue2rgb(h,g,a),f=this.hue2rgb(h,g,a-1/3)}return{r:255*d,g:255*e,b:255*f}},hue2rgb:function(a,b,c){return 0>c&&(c+=1),c>1&&(c-=1),1/6>c?a+6*(b-a)*c:.5>c?b:2/3>c?a+(b-a)*(2/3-c)*6:a},convolutionFilter:function(b,c,e){b===d&&a.error("filter not set"),e=a.extend({},{channels:"rgb",offset:0},e);for(var f=this,g=/r/i.test(e.channels),h=/g/i.test(e.channels),i=/b/i.test(e.channels),j=b.length,k=b[0].length,l=Math.floor(j/2),m=Math.floor(k/2),n=g?0:f.pixelsIn[c],o=h?0:f.pixelsIn[c+1],p=i?0:f.pixelsIn[c+2],q=4*f.w,r=0;j>r;r++)for(var s=q*(l>r?-1:r>l?1:0),t=0;k>t;t++){var u=Math.abs(t-m),v=4*(m>t?-u:t>m?+u:0);g&&(n+=b[r][t]*f.pixelsIn[c+s+v]),h&&(o+=b[r][t]*f.pixelsIn[c+1+s+v]),i&&(p+=b[r][t]*f.pixelsIn[c+2+s+v])}return[e.offset+n,e.offset+o,e.offset+p]}}),a.fn[f]=function(c){var d=!!b.CanvasRenderingContext2D;if(d)return this.each(function(){a.data(this,"plugin_"+f)||a.data(this,"plugin_"+f,new e(this,c))})}}(jQuery,window,document);