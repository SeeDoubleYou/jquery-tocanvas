/*
 *  jquery-tocanvas - v0.2.0
 *  A jquery plugin to overlay any img with a canvas to add effects to it
 *  http://seedoubleyou.nl
 *
 *  Made by Cees-Willem Hofstede
 *  Under MIT License
 */
!function(a,b){"use strict";function c(b,c){return this.element=b,this.$element=a(this.element),this.$canvas=a("<canvas>"),this.canvas=this.$canvas.get(0),this.wrapper=a("<div>"),this.$wrapper=a(this.wrapper),this.renderCount=0,this.settings=a.extend({},e,c),this._defaults=e,this._name=d,this._init()}var d="toCanvas",e={continuous:!1,framerate:0,hoverOpacity:1,opacity:1,overlay:!0,process:{},sharedOptions:{},zIndex:10};a.extend(c.prototype,{_init:function(){var a=this;if(a.$element.is("img"))a.imageObj=new Image,a.imageObj.onload=function(){a._setup(),a.render()},a.imageObj.src=this.$element.attr("src");else{if(!a.$element.is("video"))return!1;a.imageObj=a.element,a._setup(),a.$element.on("play",function(){a.render()})}return a},_setup:function(){var b=this;b.w=b.$element.width(),b.h=b.$element.height(),b.$wrapper.addClass("tc_wrapper").css({display:"inline-block",height:b.h,position:"relative",width:b.w});var c=b.settings.overlay?{left:0,opacity:b.settings.opacity,position:"absolute",top:0,zIndex:b.settings.zIndex}:{opacity:b.settings.opacity};return b.$canvas.addClass("tc_canvas").css(c).hover(function(){a(this).css({opacity:b.settings.hoverOpacity})},function(){a(this).css({opacity:b.settings.opacity})}).attr({height:b.h,width:b.w}),b.settings.overlay?(b.$element.wrap(b.$wrapper),b.$element.before(b.$canvas)):b.$element.after(b.$canvas),b.context=this.canvas.getContext("2d"),b},render:function(){var c=this;return c.imageObj.paused||c.imageObj.ended?!1:(c.draw(),a.each(c.settings.process,function(a,b){var d=Object.keys(b)[0],e=b[d];c[d](e)}),c.renderCount++,c.settings.framerate>0&&b.setTimeout(function(){c.render()},1e3/c.settings.framerate),c)},draw:function(){return this.context.drawImage(this.imageObj,0,0,this.w,this.h),this.imgdIn=this.context.getImageData(0,0,this.w,this.h),this.pixelsIn=this.imgdIn.data,this.nrPixels=this.pixelsIn.length,this.imgdOut=this.context.getImageData(0,0,this.w,this.h),this.pixelsOut=this.imgdOut.data,this},putImageData:function(){return this.context.putImageData(this.imgdOut,0,0),this.imgdIn=this.context.getImageData(0,0,this.w,this.h),this.pixelsIn=this.imgdIn.data,this.nrPixels=this.pixelsIn.length,this.imgdOut=this.context.getImageData(0,0,this.w,this.h),this.pixelsOut=this.imgdOut.data,this},process:function(b,c){c=a.extend({},{opacity:1,xPctStart:0,xPctEnd:100,yPctStart:0,yPctEnd:100},this.settings.sharedOptions,c);for(var d=Math.round(c.xPctStart*(this.w/100)),e=Math.round(c.xPctEnd*(this.w/100)),f=Math.round(c.yPctStart*(this.h/100)),g=Math.round(c.yPctEnd*(this.h/100)),h=d;e>h;h++)for(var i=f;g>i;i++){var j=4*(i*this.w+h),k=this.pixelsIn[j],l=this.pixelsIn[j+1],m=this.pixelsIn[j+2],n=this.pixelsIn[j+3],o=b(k,l,m,n,h,i,j);this.pixelsOut[j]=o[0],this.pixelsOut[j+1]=o[1],this.pixelsOut[j+2]=o[2],this.pixelsOut[j+3]=c.opacity*o[3]}return this.putImageData(),this},grayscale:function(a){return this.process(function(a,b,c,d){var e=.3*a+.59*b+.11*c;return[e,e,e,d]},a)},sepia:function(a){return this.process(function(a,b,c,d){return[.393*a+.769*b+.189*c,.349*a+.686*b+.168*c,.272*a+.534*b+.131*c,d]},a)},invert:function(a){return this.process(function(a,b,c,d){return[255-a,255-b,255-c,d]},a)},edges:function(a){var b=this,c=4*b.w;return b.process(function(a,d,e,f,g,h,i){return a=127+2*a-b.pixels[i+4]-b.pixels[i+c],d=127+2*d-b.pixels[i+5]-b.pixels[i+1+c],e=127+2*e-b.pixels[i+6]-b.pixels[i+2+c],[a,d,e,f]},a)},noise:function(b){return b=a.extend({},{amount:10},b),this.process(function(a,c,d,e){return[a+(.5-Math.random())*b.amount,c+(.5-Math.random())*b.amount,d+(.5-Math.random())*b.amount,e]},b)},pixelate:function(b){var c=this;b=a.extend({},{blockSize:100},b),blockSize=b.blockSize,blockSize=1/blockSize;var d=c.w*blockSize,e=c.h*blockSize;return c.context.mozImageSmoothingEnabled=!1,c.context.webkitImageSmoothingEnabled=!1,c.context.imageSmoothingEnabled=!1,c.context.drawImage(c.canvas,0,0,d,e),c.context.drawImage(c.canvas,0,0,d,e,0,0,this.w,this.h),c.imgdIn=c.context.getImageData(0,0,c.w,c.h),c.pixelsIn=c.imgdIn.data,c.nrPixels=c.pixelsIn.length,c.imgdOut=c.context.getImageData(0,0,c.w,c.h),c.pixelsOut=c.imgdOut.data,c.putImageData(),c},blur:function(b){return b=a.extend({},{filter:[[.1,.1,.1],[.1,.2,.1],[.1,.1,.1]]},b),this.convolutionFilter(b)},boxBlur:function(b){b=a.extend({},{radius:3},b);for(var c=b.radius,d=c*c,e=1/d,f=[],g=0;c>g;g++){for(var h=[],i=0;c>i;i++)h.push(e);f.push(h)}return b=a.extend({},{filter:f},b),this.convolutionFilter(b)},gaussianBlur:function(b){b=a.extend({},{radius:3},b);for(var c=b.radius,d=2*c+1,e=c/2,f=0,g=[],h=0;d>h;++h){for(var i=[],j=0;d>j;++j){var k=this.gaussian(h,c,e)*this.gaussian(j,c,e);i.push(k),f+=k}g.push(i)}for(var l=0;d>l;++l)for(var m=0;d>m;++m)g[l][m]/=f;return b=a.extend({},{filter:g},b),this.convolutionFilter(b)},sharpen:function(b){return this.convolutionFilter(a.extend({},{filter:[[0,-1,0],[-1,5,-1],[0,-1,0]]},b))},emboss:function(b){return b=a.extend({},{offset:127},b),this.convolutionFilter(a.extend({},{filter:[[2,0,0],[0,-1,0],[0,0,-1]]},b))},laplace:function(b){return this.convolutionFilter(a.extend({},{filter:[[0,1,0],[1,-4,1],[0,1,0]]},b))},sobel:function(a){return this.sobelVertical(a),this.putImageData(),this.sobelHorizontal(a)},sobelVertical:function(b){return this.convolutionFilter(a.extend({},{filter:[[-1,0,1],[-2,0,2],[-1,0,1]]},b))},sobelHorizontal:function(b){return this.convolutionFilter(a.extend({},{filter:[[-1,-2,-1],[0,0,0],[1,2,1]]},b))},convolutionFilter:function(b){b=a.extend({},{updateR:!0,updateG:!0,updateB:!0,offset:0,filter:[1]},b);var c=b.filter,d=this,e=c.length,f=c[0].length,g=Math.floor(e/2),h=Math.floor(f/2);return d.process(function(a,i,j,k,l,m,n){for(var o=b.updateR?0:d.pixelsIn[n],p=b.updateG?0:d.pixelsIn[n+1],q=b.updateB?0:d.pixelsIn[n+2],r=0;e>r;r++)for(var s=Math.abs(r-g),t=g>r?-s:r>g?+s:0,u=Math.max(Math.min(m+t,d.h-1),0),v=0;f>v;v++){var w=Math.abs(v-h),x=h>v?-w:v>h?+w:0,y=Math.max(Math.min(l+x,d.w-1),0),z=4*(u*d.w+y);b.updateR&&(o+=c[r][v]*d.pixelsIn[z]),b.updateG&&(p+=c[r][v]*d.pixelsIn[z+1]),b.updateB&&(q+=c[r][v]*d.pixelsIn[z+2])}return[b.offset+o,b.offset+p,b.offset+q,k]},b)},vignette:function(b){b=a.extend({},{size:.5,opacity:1},b);var c=Math.sqrt(Math.pow(this.w/2,2)+Math.pow(this.h/2,2)),d=this.context.createRadialGradient(this.w/2,this.h/2,0,this.w/2,this.h/2,c);return this.context.putImageData(this.imgdOut,0,0),this.context.globalCompositeOperation="source-over",d.addColorStop(0,"rgba(0,0,0,0)"),d.addColorStop(b.size,"rgba(0,0,0,0)"),d.addColorStop(1,"rgba(0,0,0,"+b.opacity+")"),this.context.fillStyle=d,this.context.fillRect(0,0,this.w,this.h),this.imgdOut=this.context.getImageData(0,0,this.w,this.h),this.pixelsOut=this.imgdOut.data,this},threshold:function(b){return b=a.extend({},{threshold:127},b),this.process(function(a,c,d,e){var f=.2126*a+.7152*c+.0722*d>=b.threshold?255:0;return[f,f,f,e]},b)},hue:function(a){return this.hslUpdate("h",a)},saturation:function(a){return this.hslUpdate("s",a)},brightness:function(a){return this.lightness(a)},lightness:function(a){return this.hslUpdate("l",a)},hslUpdate:function(b,c){var d=this;if(c=a.extend({},{value:0,colorize:!1},c),0===c.value&&c.colorize!==!0)return!1;var e="h"===b?360:100;return this.process(function(a,f,g,h){var i=d.rgb2hsl(a,f,g);c.colorize?i[b]=Math.min(Math.max(c.value/e,0),1):"h"===b?(i[b]=(i[b]*e+c.value)%e,i[b]<0&&(i[b]=e-i[b]),i[b]/=e):i[b]=Math.min(Math.max(i[b]+c.value/e,0),1);var j=d.hsl2rgb(i.h,i.s,i.l);return[j.r,j.g,j.b,h]},c)},contrast:function(b){b=a.extend({},{value:10},b);var c=Math.pow((b.value+100)/100,2);return this.process(function(a,b,d,e){return[255*((a/255-.5)*c+.5),255*((b/255-.5)*c+.5),255*((d/255-.5)*c+.5),e]},b)},gamma:function(b){return b=a.extend({},{value:1.5},b),this.process(function(a,c,d,e){return[a*b.value,c*b.value,d*b.value,e]},b)},rgb2hsl:function(a,b,c){a/=255,b/=255,c/=255;var d,e,f=Math.max(a,b,c),g=Math.min(a,b,c),h=(f+g)/2;if(f===g)d=e=0;else{var i=f-g;switch(e=h>.5?i/(2-f-g):i/(f+g),f){case a:d=(b-c)/i+(c>b?6:0);break;case b:d=(c-a)/i+2;break;case c:d=(a-b)/i+4}}return d/=6,{h:d,s:e,l:h}},hsl2rgb:function(a,b,c){var d,e,f;if(0===b)d=e=f=c;else{var g=.5>c?c*(1+b):c+b-c*b,h=2*c-g;d=this.hue2rgb(h,g,a+1/3),e=this.hue2rgb(h,g,a),f=this.hue2rgb(h,g,a-1/3)}return{r:255*d,g:255*e,b:255*f}},hue2rgb:function(a,b,c){return 0>c&&(c+=1),c>1&&(c-=1),1/6>c?a+6*(b-a)*c:.5>c?b:2/3>c?a+(b-a)*(2/3-c)*6:a},gaussian:function(a,b,c){return Math.exp(-((a-b)/c*((a-b)/c))/2)}}),a.fn[d]=function(e){var f,g=!!b.CanvasRenderingContext2D;return g?(this.each(function(){f=a.data(this,"plugin_"+d),f||(f=new c(this,e),a.data(this,"plugin_"+d,f))}),f):!1}}(jQuery,window,document);